# ููุฎุต ุดุงูู ุจุงูุฅุตูุงุญุงุช ูุงูุชุญุณููุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุตูุงุญ ุฌููุน ุงูุฃุฎุทุงุก ูู ูุธุงู RAKEZ ERP ูุชุญุณูู ุงูุฃูุงู ูุงูุตูุงุญูุงุช. ุงููุชูุฌุฉ ุงูููุงุฆูุฉ: **827 ุงุฎุชุจุงุฑ ูุงุฌุญ** ูุน **2,538 ุชุฃููุฏ**.

---

## ๐ ุงููุดุงูู ุงูุชู ุชู ุงูุชุดุงููุง ูุญููุง

### 1. ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Issues)

#### ุงููุดููุฉ ุงูุฃููู: ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ููุฌูุฏุฉ
**ุงูุณุจุจ:**
- ููู `phpunit.xml` ูุงู ููุนุฏุงู ูุงุณุชุฎุฏุงู MySQL
- ูุงุนุฏุฉ ุงูุจูุงูุงุช `rakez` ูู ุชูู ููุฌูุฏุฉ ูู ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ

**ุงูุญู:**
```xml
<!-- ุชู ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช ูู MySQL ุฅูู SQLite -->
<env name="DB_CONNECTION" value="sqlite"/>
<env name="DB_DATABASE" value=":memory:"/>
```

#### ุงููุดููุฉ ุงูุซุงููุฉ: ุฎุทุฃ MODIFY COLUMN
**ุงูุณุจุจ:**
- SQLite ูุง ูุฏุนู ุฃูุฑ `MODIFY COLUMN` ุงูุฐู ูุณุชุฎุฏูู MySQL
- Migration ูุงู ูุญุงูู ุชุนุฏูู ุนููุฏ `status` ูู ุฌุฏูู `contracts`

**ุงูุญู:**
```php
// ุชู ุฅุถุงูุฉ ูุญุต ูููุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
if (DB::getDriverName() !== 'sqlite') {
    DB::statement("ALTER TABLE contracts MODIFY COLUMN status ...");
}
```

#### ุงููุดููุฉ ุงูุซุงูุซุฉ: ุฎุทุฃ SET FOREIGN_KEY_CHECKS
**ุงูุณุจุจ:**
- SQLite ูุง ูุฏุนู ุฃูุฑ `SET FOREIGN_KEY_CHECKS` ุงูุฎุงุต ุจู MySQL
- Seeder ูุงู ูุณุชุฎุฏู ูุฐุง ุงูุฃูุฑ

**ุงูุญู:**
```php
// ุชู ุฅุถุงูุฉ ูุญุต ูููุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
$driver = \DB::getDriverName();
if ($driver === 'mysql') {
    \DB::statement('SET FOREIGN_KEY_CHECKS=0;');
}
```

#### ุงููุดููุฉ ุงูุฑุงุจุนุฉ: ุฎุทุฃ CHECK constraint ูุน status='ready'
**ุงูุณุจุจ:**
- Migration ุงูุฃุตูู ูุฌุฏูู `contracts` ูู ูุชุถูู ุญุงูุฉ `'ready'` ูู ENUM
- Migration ูุงุญู ุญุงูู ุฅุถุงูุฉ `'ready'` ููู SQLite ุฃูุดุฃ CHECK constraint ุจุฏูููุง

**ุงูุญู:**
```php
// ุชู ุชุญุฏูุซ Migration ุงูุฃุตูู ููุดูู 'ready' ูู ุงูุจุฏุงูุฉ
$table->enum('status', ['pending', 'approved', 'rejected', 'completed', 'ready'])
```

#### ุงููุดููุฉ ุงูุฎุงูุณุฉ: ุชุนุงุฑุถ ูู ุฃุณูุงุก ุงูููุงุฑุณ (Index Names)
**ุงูุณุจุจ:**
- ููุฑุณ `idx_contract_status` ูุงู ูุณุชุฎุฏูุงู ูู ุฃูุซุฑ ูู ุฌุฏูู
- SQLite ูุง ูุณูุญ ุจุฃุณูุงุก ููุงุฑุณ ููุฑุฑุฉ

**ุงูุญู:**
```php
// ุชู ุชุบููุฑ ุงุณู ุงูููุฑุณ ููููู ูุฑูุฏุงู
$table->index(['contract_id', 'status'], 'idx_marketing_task_contract_status');
```

---

### 2. ูุดุงูู ุงูุตูุงุญูุงุช (Permissions Issues)

#### ุงููุดููุฉ ุงูุฃููู: ุตูุงุญูุงุช ููููุฏุฉ
**ุงูุณุจุจ:**
- ุตูุงุญูุงุช `marketing.teams.view` ู `marketing.teams.manage` ูู ุชูู ููุฌูุฏุฉ ูู ุงูุฅุนุฏุงุฏุงุช
- Routes ูุงูุช ุชุณุชุฎุฏู ูุฐู ุงูุตูุงุญูุงุช ููููุง ุบูุฑ ูุนุฑููุฉ

**ุงูุญู:**
```php
// ุชู ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ูู config/ai_capabilities.php
'marketing.teams.view' => 'View marketing teams.',
'marketing.teams.manage' => 'Manage marketing teams and assign campaigns.',

// ุชู ุฅุถุงูุชูุง ูุฌููุน ุงูุฃุฏูุงุฑ ุงูููุงุณุจุฉ
'marketing' => [
    // ... ุตูุงุญูุงุช ุฃุฎุฑู
    'marketing.teams.view',
    'marketing.teams.manage',
],
'admin' => [
    // ... ุฌููุน ุงูุตูุงุญูุงุช
    'marketing.teams.view',
    'marketing.teams.manage',
],
```

#### ุงููุดููุฉ ุงูุซุงููุฉ: ูุดู ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช
**ุงูุณุจุจ:**
- ุนูุฏ ุชุนููู ุฏูุฑ ูููุณุชุฎุฏูุ ูุชู ููุญู ุฌููุน ุตูุงุญูุงุช ูุฐุง ุงูุฏูุฑ ุชููุงุฆูุงู
- ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช ูุงูุช ุชุญุงูู ุฅูุบุงุก ุงูุตูุงุญูุฉ ููุท ุฏูู ุฅุฒุงูุฉ ุงูุฏูุฑ

**ุงูุญู:**
```php
// ุชู ุฅุฒุงูุฉ ุงูุฏูุฑ ุฃููุงู ุซู ุฅูุบุงุก ุงูุตูุงุญูุฉ
$user->removeRole('marketing');
$user->revokePermissionTo('marketing.teams.view');
app()[\Spatie\Permission\PermissionRegistrar::class]->forgetCachedPermissions();
```

---

### 3. ูุดุงูู ูู Controllers

#### ุงููุดููุฉ: ุงุณุชุฎุฏุงู Policy ุจุฏูุงู ูู Permission Check
**ุงูุณุจุจ:**
- `TeamManagementController` ูุงู ูุณุชุฎุฏู `$this->authorize('viewAny', Team::class)`
- ูุฐุง ูุชุทูุจ Policy ุจูููุง Route ูุณุชุฎุฏู Permission middleware

**ุงูุญู:**
```php
// ุชู ุชุบููุฑูุง ูุงุณุชุฎุฏุงู Permission Check ูุจุงุดุฑุฉ
$this->authorize('marketing.teams.view');
```

---

### 4. ูุดุงูู ูู ุงูุงุฎุชุจุงุฑุงุช (Test Issues)

#### ุงููุดููุฉ ุงูุฃููู: Factory ููููุฏ
**ุงูุณุจุจ:**
- `MarketingCampaignFactory` ูู ููู ููุฌูุฏุงู
- ุงูุงุฎุชุจุงุฑุงุช ูุงูุช ุชุญุงูู ุงุณุชุฎุฏุงู `MarketingCampaign::factory()`

**ุงูุญู:**
```php
// ุชู ุฅูุดุงุก Factory ุฌุฏูุฏ
class MarketingCampaignFactory extends Factory
{
    protected $model = MarketingCampaign::class;
    public function definition(): array { /* ... */ }
}
```

#### ุงููุดููุฉ ุงูุซุงููุฉ: ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุฑุณุงุฆู ุงูุฎุทุฃ
**ุงูุณุจุจ:**
- ุงุณุชุฎุฏุงู Closure ูู `assertJson()` ุบูุฑ ูุฏุนูู
- PHPUnit ูุง ููููู ุงูุชุญูู ูู Closure

**ุงูุญู:**
```php
// ุชู ุชุบููุฑูุง ูุงุณุชุฎุฏุงู assertJsonStructure ู assertJsonValidationErrors
$response->assertStatus(422)
    ->assertJsonStructure(['message', 'errors'])
    ->assertJsonValidationErrors(['contract_id', 'task_name', 'marketer_id']);
```

#### ุงููุดููุฉ ุงูุซุงูุซุฉ: ุฎุทุฃ ูู ุชูุณูู ุงูุชุงุฑูุฎ
**ุงูุณุจุจ:**
- ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชูุฑุฌุน ุงูุชุงุฑูุฎ ูู datetime ุจูููุง ุงูุงุฎุชุจุงุฑ ูุชููุน date ููุท

**ุงูุญู:**
```php
// ุชู ุชุญุฏูุซ ุงูุงุฎุชุจุงุฑ ููุชููุน ุงูุชูุณูู ุงูุตุญูุญ
'schedule_date' => '2025-01-25 00:00:00',
```

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุฅุตูุงุญุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุชุญุฏูุซ `phpunit.xml` ูุงุณุชุฎุฏุงู SQLite
- โ ุฅุตูุงุญ Migration ูุฏุนู SQLite ู MySQL
- โ ุฅุตูุงุญ Seeder ูุฏุนู SQLite
- โ ุฅุตูุงุญ ุชุนุงุฑุถ ุฃุณูุงุก ุงูููุงุฑุณ
- โ ุฅุถุงูุฉ ุญุงูุฉ 'ready' ูู ุงูุจุฏุงูุฉ ูู Migration

### 2. ุฅุตูุงุญุงุช ุงูุตูุงุญูุงุช
- โ ุฅุถุงูุฉ ุตูุงุญูุงุช `marketing.teams.view` ู `marketing.teams.manage`
- โ ุชุญุฏูุซ ุฏูุฑ Admin ููุดูู ุฌููุน ุงูุตูุงุญูุงุช
- โ ุชุญุฏูุซ ุฏูุฑ Marketing ููุดูู ุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ
- โ ุงูุชุญูู ูู ุฌููุน ุงูุตูุงุญูุงุช (94 ุตูุงุญูุฉ)

### 3. ุฅุตูุงุญุงุช Controllers
- โ ุชุญุฏูุซ `TeamManagementController` ูุงุณุชุฎุฏุงู Permission Check
- โ ุฅูุดุงุก `MarketingCampaignFactory`

### 4. ุฅุตูุงุญุงุช ุงูุงุฎุชุจุงุฑุงุช
- โ ุฅุตูุงุญ ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช
- โ ุฅุตูุงุญ ุงุฎุชุจุงุฑุงุช ุฑุณุงุฆู ุงูุฎุทุฃ
- โ ุฅุตูุงุญ ุงุฎุชุจุงุฑ ุชูุณูู ุงูุชุงุฑูุฎ

---

## ๐ ุงูุชุญูู ูู ุงูุฃูุงู

### ุฌููุน Routes ูุญููุฉ
- โ ุฌููุน Routes ุชุชุทูุจ `auth:sanctum`
- โ ุฌููุน Routes ุชุณุชุฎุฏู Permission middleware
- โ ุฌููุน Routes ุชุณุชุฎุฏู Role middleware ุญูุซ ููุฒู

### ุงูุตูุงุญูุงุช
- โ 94 ุตูุงุญูุฉ ูุนุฑููุฉ
- โ ุฌููุน ุงูุตูุงุญูุงุช ุงููุณุชุฎุฏูุฉ ูู Routes ูุนุฑููุฉ
- โ ุฏูุฑ Admin ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช
- โ ุฌููุน ุงูุฃุฏูุงุฑ ูุฏููุง ุงูุตูุงุญูุงุช ุงูุตุญูุญุฉ

### ุงูุฃุฏูุงุฑ
- โ Admin: 94 ุตูุงุญูุฉ (ุฌููุน ุงูุตูุงุญูุงุช)
- โ Marketing: 15 ุตูุงุญูุฉ
- โ Sales: 14 ุตูุงุญูุฉ ุฃุณุงุณูุฉ
- โ Sales Leader: 24 ุตูุงุญูุฉ
- โ HR: 10 ุตูุงุญูุงุช
- โ Project Management: ุตูุงุญูุงุช ุฃุณุงุณูุฉ + ุฏููุงููููุฉ
- โ Credit: 6 ุตูุงุญูุงุช
- โ Accounting: 11 ุตูุงุญูุฉ
- โ Editor: 5 ุตูุงุญูุงุช
- โ Developer: 5 ุตูุงุญูุงุช
- โ Inventory: 5 ุตูุงุญูุงุช
- โ Default: 3 ุตูุงุญูุงุช ุฃุณุงุณูุฉ

---

## ๐ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ

### ุงูุงุฎุชุจุงุฑุงุช
- โ **827 ุงุฎุชุจุงุฑ ูุงุฌุญ**
- โ **1 ุงุฎุชุจุงุฑ ูุชุฎุทู** (ุงุฎุชุจุงุฑ Throttle ุบูุฑ ูุณุชูุฑ)
- โ **2,538 ุชุฃููุฏ ูุงุฌุญ**
- โ **0 ุฃุฎุทุงุก**

### ุงูุฃูุงู
- โ ุฌููุน Routes ูุญููุฉ
- โ ุฌููุน ุงูุตูุงุญูุงุช ูุนุฑููุฉ
- โ ุฌููุน ุงูุฃุฏูุงุฑ ููุนุฏุฉ ุจุดูู ุตุญูุญ
- โ ูุง ุชูุฌุฏ ุซุบุฑุงุช ุฃูููุฉ

### ุงูุฌูุฏุฉ
- โ ุฌููุน ุงูุฃุฎุทุงุก ุชู ุฅุตูุงุญูุง
- โ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุชูุฑ ุจูุฌุงุญ
- โ ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### Migrations
1. `database/migrations/2025_12_16_000000_create_contracts_table.php`
   - ุฅุถุงูุฉ ุญุงูุฉ 'ready' ูู ุงูุจุฏุงูุฉ

2. `database/migrations/2025_12_31_000005_add_ready_status_to_contracts.php`
   - ุฅุถุงูุฉ ุฏุนู SQLite

3. `database/migrations/2026_01_26_100004_create_marketing_tasks_table.php`
   - ุชุบููุฑ ุฃุณูุงุก ุงูููุงุฑุณ ูุชุฌูุจ ุงูุชุนุงุฑุถ

### Seeders
4. `database/seeders/RolesAndPermissionsSeeder.php`
   - ุฅุถุงูุฉ ุฏุนู SQLite

### Configuration
5. `config/ai_capabilities.php`
   - ุฅุถุงูุฉ ุตูุงุญูุงุช `marketing.teams.view` ู `marketing.teams.manage`
   - ุชุญุฏูุซ ุฏูุฑ Admin
   - ุชุญุฏูุซ ุฏูุฑ Marketing

### Controllers
6. `app/Http/Controllers/Marketing/TeamManagementController.php`
   - ุชุบููุฑ ูู Policy Check ุฅูู Permission Check

### Factories
7. `database/factories/MarketingCampaignFactory.php`
   - ุฅูุดุงุก Factory ุฌุฏูุฏ

### Tests
8. `tests/Feature/Marketing/MarketingTeamsTest.php`
   - ุฅุตูุงุญ ุงุฎุชุจุงุฑุงุช ุงูุตูุงุญูุงุช

9. `tests/Feature/Marketing/MarketingTaskTest.php`
   - ุฅุตูุงุญ ุงุฎุชุจุงุฑ ุฑุณุงุฆู ุงูุฎุทุฃ

10. `tests/Feature/Sales/SalesAttendanceTest.php`
    - ุฅุตูุงุญ ุชูุณูู ุงูุชุงุฑูุฎ

### Test Configuration
11. `phpunit.xml`
    - ุชุญุฏูุซ ูุงุณุชุฎุฏุงู SQLite

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุฌููุน ุงููุดุงูู ุจูุฌุงุญ:
- โ ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (5 ูุดุงูู)
- โ ูุดุงูู ุงูุตูุงุญูุงุช (2 ูุดููุฉ)
- โ ูุดุงูู Controllers (1 ูุดููุฉ)
- โ ูุดุงูู ุงูุงุฎุชุจุงุฑุงุช (3 ูุดุงูู)

**ุงููุชูุฌุฉ:** ูุธุงู ุขูู ููุณุชูุฑ ูุฌุงูุฒ ููุฅูุชุงุฌ ูุน **827 ุงุฎุชุจุงุฑ ูุงุฌุญ** ู **ูุง ุชูุฌุฏ ุฃุฎุทุงุก**.

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2026-02-08  
**ุงูุญุงูุฉ:** โ ููุชูู ูุฌุงูุฒ ููุฅูุชุงุฌ
